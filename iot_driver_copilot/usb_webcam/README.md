USB Webcam HTTP Driver (Python)

This driver connects to a USB UVC webcam via OpenCV (native OS camera stack) and exposes an HTTP interface to fetch a single JPEG frame or stream MJPEG.

Endpoints
- GET /frame: returns a single JPEG snapshot
- GET /stream: returns an MJPEG stream (multipart/x-mixed-replace)

Environment variables (required)
- HTTP_HOST: Host/IP to bind the HTTP server (e.g., 0.0.0.0)
- HTTP_PORT: Port to bind the HTTP server (e.g., 8000)
- CAMERA_INDEX: Integer index of the webcam (e.g., 0)
- RECONNECT_INITIAL_BACKOFF_MS: Initial reconnect backoff in milliseconds (e.g., 200)
- RECONNECT_MAX_BACKOFF_MS: Maximum reconnect backoff in milliseconds (e.g., 5000)
- READ_ERRORS_BEFORE_RESET: Number of consecutive read failures before resetting the camera (e.g., 30)
- FRAME_WAIT_TIMEOUT_SEC: Max seconds an HTTP request will wait for a first frame (e.g., 3)
- JPEG_QUALITY: JPEG encode quality (1-100; e.g., 80)

Environment variables (optional)
- WIDTH: Desired capture width in pixels
- HEIGHT: Desired capture height in pixels
- FPS: Desired frames per second

Install
- Python 3.9+ is recommended
- Install dependencies:
  pip install -r requirements.txt

Run
Set environment variables and start the driver:

HTTP_HOST=0.0.0.0 \
HTTP_PORT=8000 \
CAMERA_INDEX=0 \
RECONNECT_INITIAL_BACKOFF_MS=200 \
RECONNECT_MAX_BACKOFF_MS=5000 \
READ_ERRORS_BEFORE_RESET=30 \
FRAME_WAIT_TIMEOUT_SEC=3 \
JPEG_QUALITY=80 \
python driver.py

Quick test
- Single frame:
  curl -v http://localhost:8000/frame -o snapshot.jpg
- MJPEG stream (view in browser):
  open http://localhost:8000/stream  (or paste URL in your browser)

Notes
- This server actively captures frames in a background thread, buffers the latest JPEG, and serves it quickly to clients.
- Implements reconnection with exponential backoff if the camera disconnects.
- Graceful shutdown: Ctrl+C or send SIGTERM to stop capture and HTTP server cleanly.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)
