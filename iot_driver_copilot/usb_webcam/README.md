USB Webcam HTTP Driver (UVC â†’ HTTP)

This driver connects to a USB UVC webcam, continuously captures frames, and exposes them over a lightweight HTTP server.

- Native protocol: UVC (USB Video Class)
- Output protocol: HTTP (JPEG frame and MJPEG stream)
- Language: Python

Exposed endpoints

- GET /frame
  - Returns the latest frame as image/jpeg.
- GET /stream
  - Returns a multipart/x-mixed-replace MJPEG stream. Each part is a JPEG frame.

Quick start

1) Install dependencies

- Python 3.9+ recommended
- Install Python packages:

  pip install -r requirements.txt

2) Plug your USB webcam

3) Run the driver

- Defaults to camera index 0 on port 8000:

  HTTP_PORT=8000 WEBCAM_DEVICE=0 python driver.py

4) Try it

- Fetch a single snapshot:

  curl -v http://localhost:8000/frame -o snapshot.jpg

- Open live MJPEG stream in a browser:

  http://localhost:8000/stream

Environment variables

- HTTP_HOST (default: 0.0.0.0)
  - Host/IP for the HTTP server to bind.
- HTTP_PORT (default: 8000)
  - Port for the HTTP server.
- WEBCAM_DEVICE (default: 0)
  - Camera index (e.g., 0) or device path (e.g., /dev/video0).
- WEBCAM_WIDTH (optional)
  - Requested capture width in pixels.
- WEBCAM_HEIGHT (optional)
  - Requested capture height in pixels.
- WEBCAM_FPS (optional)
  - Requested capture frame rate.
- JPEG_QUALITY (default: 80, range: 1-100)
  - JPEG compression quality for frames.
- CAPTURE_TIMEOUT_SEC (default: 5.0)
  - Watchdog for frame acquisition; used to determine when to reopen the device if frames stall.
- RECONNECT_BASE_BACKOFF_SEC (default: 0.5)
  - Initial backoff delay when reconnecting the camera.
- RECONNECT_MAX_BACKOFF_SEC (default: 10.0)
  - Maximum backoff delay when reconnecting the camera.
- LOG_LEVEL (default: INFO)
  - One of: DEBUG, INFO, WARNING, ERROR, CRITICAL.

Behavior and notes

- The driver runs a background capture loop that continuously ingests UVC frames, encodes them to JPEG, and stores the most recent frame in a thread-safe buffer.
- If the camera disconnects or frame reads fail, the driver retries with exponential backoff and logs events.
- Multiple clients can connect to /stream concurrently; each receives the latest frames as they arrive.
- Graceful shutdown is supported via Ctrl+C (SIGINT) or SIGTERM.

Troubleshooting

- On Linux, the webcam usually appears as /dev/video0, /dev/video1, etc.
- If you see connection or frame read errors, try lowering resolution or FPS with WEBCAM_WIDTH/HEIGHT/FPS.
- Some platforms/backends may not support all property settings; the driver attempts them best-effort.

License

- This project is provided as-is, for demonstration and integration purposes.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)
