USB Webcam HTTP Driver (Python)

This driver connects to a USB UVC webcam and exposes an HTTP interface for a live MJPEG stream and single-frame capture. It runs a background capture loop, keeps the latest frame in a thread-safe buffer, and serves it over HTTP.

Endpoints
- GET /frame
  - Returns a single JPEG snapshot (image/jpeg). If no frame is available yet, returns 503.
- GET /stream
  - Returns a multipart/x-mixed-replace MJPEG stream. Keep the connection open to receive continuous frames.

Configuration (Environment Variables)
- HTTP_HOST: HTTP server bind address (default: 0.0.0.0)
- HTTP_PORT: HTTP server port (default: 8000)
- CAMERA_DEVICE: Camera device index (e.g., 0) or path (e.g., /dev/video0). Default: 0
- WIDTH: Requested frame width (default: 640)
- HEIGHT: Requested frame height (default: 480)
- FPS: Requested frames per second (default: 30)
- CONNECT_TIMEOUT_SEC: Seconds to wait for a frame after opening the camera (default: 5.0)
- FRAME_STALE_SEC: If no valid frames are read for this many seconds, reconnect (default: 5.0)
- BACKOFF_INITIAL_MS: Initial reconnect backoff in milliseconds (default: 200)
- BACKOFF_MAX_MS: Maximum reconnect backoff in milliseconds (default: 5000)
- JPEG_QUALITY: JPEG quality (1-100) for both frame and stream (default: 80)
- LOG_LEVEL: Logging level (e.g., DEBUG, INFO, WARNING). Default: INFO

Run
1) Install dependencies
   pip install -r requirements.txt

2) Set desired environment variables (optional) and run the driver
   export HTTP_HOST=0.0.0.0
   export HTTP_PORT=8000
   export CAMERA_DEVICE=0
   python3 driver.py

Quick Test
- Snapshot:
  curl -o snapshot.jpg http://localhost:8000/frame

- Live stream (open in a browser or use curl -v):
  curl -v http://localhost:8000/stream

Notes
- The driver connects to the webcam using the native UVC path via OpenCV and converts frames to JPEG for HTTP delivery; it does not expose native device URLs.
- Background capture includes timeout, retry with exponential backoff, logging of connect/disconnect, and last frame timestamps.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)
