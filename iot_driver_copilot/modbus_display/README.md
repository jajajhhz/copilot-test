Modbus Display HTTP Driver (Golang)

This driver connects to a Modbus RTU 7-segment display module (e.g., QX-SEG34/QX-SEG34B/QX-SEG06), continuously reads the device state, and exposes a minimal HTTP API for configuration and value updates. It performs native Modbus RTU communication and converts it to HTTP endpoints.

Requirements
- Go 1.20+
- Serial adapter connected to the device

Environment Variables (all required)
- HTTP_HOST: HTTP server bind host (e.g., 0.0.0.0)
- HTTP_PORT: HTTP server port (e.g., 8080)
- SERIAL_PORT: Serial device path (e.g., /dev/ttyUSB0)
- SLAVE_ID: Modbus slave address (1..247)
- BAUD_RATE: Serial baud rate (e.g., 9600)
- DATA_BITS: Serial data bits (5..8)
- PARITY: Serial parity (N/E/O)
- STOP_BITS: Serial stop bits (1 or 2)
- MODBUS_TIMEOUT_MS: Modbus request timeout in milliseconds
- POLL_INTERVAL_MS: Polling interval in milliseconds
- BACKOFF_INITIAL_MS: Initial reconnect backoff in milliseconds
- BACKOFF_MAX_MS: Maximum reconnect backoff in milliseconds
- REG_ADDR_DEVICE_ADDRESS: Holding register address for device address
- REG_ADDR_BAUD_RATE: Holding register address for baud rate
- REG_ADDR_COMM_FORMAT: Holding register address for communication format code
- REG_ADDR_WORK_MODE: Holding register address for work mode
- REG_ADDR_VALUE_TYPE: Holding register address for value type
- REG_ADDR_DECIMALS: Holding register address for decimals
- REG_ADDR_DP_MASK: Holding register address for decimal point mask
- REG_ADDR_BLINK_MASK: Holding register address for blink mask
- REG_ADDR_BLINK_PERIOD_MS: Holding register address for blink period (ms)
- REG_ADDR_DISPLAY_VALUE_START: Start holding register for display value (ASCII)
- REG_DISPLAY_VALUE_REGS: Number of registers used for display value (each register = 2 ASCII chars)

Run
- Build: go build -o driver
- Execute: set all envs, then run ./driver

HTTP APIs
- GET /status
  Returns current device configuration and display state.
- PUT /blink/period
  Body: {"blink_period_ms": 500}
- PUT /display/config
  Body: {"value_type": 1, "decimals": 2, "work_mode": 0}
- PUT /display/value
  Body: {"display_value": "123.45"}
- PUT /comm/config
  Body: {"device_address": 5, "baud_rate": 9600, "comm_format": "8N1"}

Quick Examples
- curl http://localhost:8080/status
- curl -X PUT http://localhost:8080/display/value -H 'Content-Type: application/json' -d '{"display_value":"1234"}'
- curl -X PUT http://localhost:8080/display/config -H 'Content-Type: application/json' -d '{"value_type":1,"decimals":2,"work_mode":0}'
- curl -X PUT http://localhost:8080/blink/period -H 'Content-Type: application/json' -d '{"blink_period_ms":300}'
- curl -X PUT http://localhost:8080/comm/config -H 'Content-Type: application/json' -d '{"device_address":2,"baud_rate":9600,"comm_format":"8E1"}'

Notes
- Register addresses vary by device firmware; configure them correctly via environment variables.
- Display value is treated as ASCII across REG_DISPLAY_VALUE_REGS registers (two characters per register). The driver pads with spaces when writing.
- The driver maintains a background polling loop with exponential backoff and logs connect/disconnect and errors.

Generated by [IoT Driver Copilot](https://copilot.test.shifu.dev/)
